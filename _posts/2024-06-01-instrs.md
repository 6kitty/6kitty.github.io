---
layout: post
title: "instrs"
categories: [Writeup]
tags: [CTF, Reverse Engineering]
last_modified_at: 2024-06-01
---

```cpp
__int64 __fastcall main(__int64 a1, char **a2, char **a3)
{
  int v4; // [rsp+1Ch] [rbp-24h]
  char *lineptr; // [rsp+20h] [rbp-20h] BYREF
  size_t n; // [rsp+28h] [rbp-18h] BYREF
  FILE *stream; // [rsp+30h] [rbp-10h]
  unsigned __int64 v8; // [rsp+38h] [rbp-8h]

  v8 = __readfsqword(0x28u);
  sub_12EA(a1, a2, a3);
  memset(&unk_4050, 0, 8uLL);
  memset(&unk_4060, 0, 8uLL);
  dword_4070 = 0;
  dword_406C = 0;
  puts("Enter Your Program");
  read(0, &unk_4050, 8uLL);
  byte_4058 = 0;
  v4 = sub_136D();
  printf("Result: %d\n", (unsigned int)v4);
  if (v4 > 99999)
  {
    lineptr = 0LL;
    n = 0LL;
    stream = fopen("./flag", "r");
    getline(&lineptr, &n, stream);
    printf("Good, get the flag: %s", lineptr);
    free(lineptr);
    fclose(stream);
  }
  return 0LL;
}
```

main은 여기 

1. v4>99999 해야함 

![Image](https://blog.kakaocdn.net/dna/bPmceQ/btsHKbe96qH/AAAAAAAAAAAAAAAAAAAAAMWwNuDwBRqsMTDoATs9TjKKdDo8bXsr3un4GjrSWe4p/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=e5YGD3CEvag5yreJXwxk9JqLz80%3D)

```cpp
void makev4()
{
  unsigned int v0; // eax
  unsigned int v1; // eax
  int v2; // [rsp+8h] [rbp-8h]

  v2 = 0;
  while (1)
  {
    ++v2;
    v0 = byte_4050[dword_406C];
    if (v0 > 0x72)
      goto LABEL_11;
    if (byte_4050[dword_406C] >= 0x61u)
      break;
    if (v0 == 43)
    {
      ++byte_4060[dword_4070];
    }
    else
    {
      if (v0 != 45)
        goto LABEL_11;
      --byte_4060[dword_4070];
    }
    if (++dword_406C > 7)
      dword_406C = 7;
  }
  v1 = v0 - 97;
  if (v1 <= 0x11)
    __asm { jmp     rax }
LABEL_11:
  puts("No Hack!");
  exit(-1);
}
```

v0<=0x72 해야함 

![Image](https://blog.kakaocdn.net/dna/bWunk3/btsHMftfzyt/AAAAAAAAAAAAAAAAAAAAAGQqtwA-mqjBk8IJfvneIkD4V2YuVb68klQgvszvg2DU/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=HRHGrDCeZEGD4OXOrFEajlVPxEg%3D)

![Image](https://blog.kakaocdn.net/dna/qRFKS/btsHJT6Ry5s/AAAAAAAAAAAAAAAAAAAAAKlQ_GGV2fGD4GG8s-2s3DtT9ErJN507Q6k4XAzNWE0l/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=eB6JyBIrJgyHnAbPHjL8AxoZ4M0%3D)

v1이 분기의 조건이 되는 거 같은데.. 일단 함수 의도를 모르겠으니 pass 

main 다시 뜯어보니까 unsigned100000 초기화 해주는 게 없는데... 

내가 rename 하다가 디컴파일 코드가 좀 바뀐 거 같다. 동적 분석으로 넘어가서 봐야할 거 같다.