---
layout: post
title: "[8주차] 제작 문제 풀이"
categories: [System Hacking]
tags: [CTF, Reverse Engineering]
last_modified_at: 2024-06-07
---

파일을 실행하면 이렇게 뜬다.

![파일 실행 결과](https://blog.kakaocdn.net/dna/rNwjH/btsHSEtlygt/AAAAAAAAAAAAAAAAAAAAAMToygJPo5wGG8Qm0uqphqkIYUsYUgXfqzmodIDUncJC/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=M7sNfHE5nmb35dy8RJ%2Bfjzr83n0%3D)

아이다로 디컴파일 했을 때 main이 위와 같다. 결론부터 말하면 위 for문을 반대로 만들면 끝나는 문제이다.

```cpp
//원래 코드 
for ( i = 27; i >= 0; --i )
    *v3++ += byte_406000[i] - i;

//수정 코드 
for ( i = 0; i <= 27; ++i )
    *v3++ += byte_406000[i] + i;
```

byte_406000의 배열은 위와 같다(16진수).

푸는 방법은 두 가지가 있다.
1. 파이썬이나 C++로 코드를 작성하고 실행하기
2. 어셈블리 수정

어셈블리를 이해한다면 이걸 수정하는 편이 더 편하다(코드를 작성하려면 조금 귀찮다).

간단하게 sub cl, al에서 sub를 add로만 바꿔보자.

![어셈블리 수정](https://blog.kakaocdn.net/dna/GZZFE/btsHTglejP3/AAAAAAAAAAAAAAAAAAAAAD4u77188mHNyJxW_A3unzy-H-vttYoVLMeC9oUZ6G0B/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=jAyKfzr2TLhAwI%2B0CKTF5xa%2BtDs%3D)

아래 덤프를 보면 문자열이 담긴 것을 알 수 있다.

![문자열 덤프](https://blog.kakaocdn.net/dna/bKqngt/btsHRK2yFlr/AAAAAAAAAAAAAAAAAAAAAAcY6vwqL7nQqK1hlZKWsMvyMhfQ48hwOo6su9XgFrJX/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=C7OJn7tUqCya6T7B4ZrT1MDuuTw%3D)

다만 경고창에 SWING{} format이 맞냐고 물어본다. 출력된 문자열을 거꾸로 하면 SWING{} format이 맞아서 직접 눈으로 풀어도 되지만 0부터 증가하며 실행되는 반복문으로 수정해보자.

일단 반복문 시작 전 eax에 초기화를 해주고 있는데 이부분을 1B가 아닌 0으로 설정해주고 sub cl, al은 아까와 같이 add cl, al로 바꿔준다. sub eax, 1을 add eax, 1로 바꿔준다.

그리고 f8을 누르며 동적 분석해준다.

![동적 분석](https://blog.kakaocdn.net/dna/b3FCnY/btsHRJvO3nE/AAAAAAAAAAAAAAAAAAAAAJzxvsbw1-bNHvUWDoHKKA7eK-Nd_rj68LdD4vfU3bxQ/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=5KIY%2BTBBS6EmXrQ%2BEFRHCGFHn%2Fg%3D)

덤프를 보면 맞게 쓰였다. 이걸 출력까지 해주려면 }까지 루프를 돌려주고 멈춰야 한다. 임의로 코드를 수정했기 때문에 jns가 무한 루프문이 된다. 여길 나가려면 FLAG에 SF를 0에서 1로 바꿔준다.

![플래그 수정](https://blog.kakaocdn.net/dna/dL7Yda/btsHR1Qvo58/AAAAAAAAAAAAAAAAAAAAAFHsgOMOJ6s5btIZGJGLtkr3FQYkDzv-TeMD9bXc4WIb/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=B548mHhEiYdYt7e0b9iExyue2o8%3D)

오른쪽 참조.

![디버깅 결과](https://blog.kakaocdn.net/dna/kUO4I/btsHS0Xeu1w/AAAAAAAAAAAAAAAAAAAAANC3h3neK7k34AuRpU4vdMwncwqxnhEzErH1M02b8xTE/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=%2Bw5L08T9qxqGS675obF%2Fk%2FZeV4g%3D)

이러고 f8을 또 열심히 누르면 디버깅창에 flag가 알맞게 뜬다.