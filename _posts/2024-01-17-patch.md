---
layout: post
title: "patch"
categories: [System Hacking]
tags: [IDA, WinMain, CreateWindowExW, RegisterClassExW, WNDCLASSEXW, sub_7FF7FB7A32F0, sub_7FF7FB7A2C40, sub_7FF7FB7A2B80, binary patch]
last_modified_at: 2024-01-17
---

IDA에서 WinMain함수 찾기  
CreateWindowExW: 윈도우를 생성할 때 사용, 보통 winmain 함수에서 사용하고 있음  
RegisterClassExW: 윈도우 클래스 등록 함수  

![WNDCLASSEXW로 정의된 v11](https://blog.kakaocdn.net/dna/CxQsP/btsDxLjGQtx/AAAAAAAAAAAAAAAAAAAAAHSUijbf4-IIb7hLP2NbCUC2sqVJYlRpvC3xZS9u0dxA/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=VXYNwBBYphMqpHEvziGMMNcIjvY%3D)  
14번째 줄에 lpfnWndProc(메시지 콜백) 정의  
메시지 콜백함수에 윈도우 동작 정의되어 있음  

sub_7FF7FB7A32F0 분석  

![sub_7FF7FB7A32F0 분석](https://blog.kakaocdn.net/dna/qAMEj/btsDxKyoa7o/AAAAAAAAAAAAAAAAAAAAAA8aLsmcYuMWT9hPbAAk4Z5s2CXVv82TbN6-O9fOemM8/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=3g8yZtkmJF6Ud%2BIyn0jXxcKk1uo%3D)  
case문 존재, 그중에서 0xF가 BeginPaint  

sub_7FF7FB7A2C40 분석  

![sub_7FF7FB7A2C40 분석](https://blog.kakaocdn.net/dna/b0FXT2/btsDACMSOlY/AAAAAAAAAAAAAAAAAAAAAGN9PrQI8cj0WoYaazTPp6AY9Nk-Q74leb6Jz53KEHev/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=GmkacXY94h48N1bcGwSYlJ5F1HQ%3D)  
sub_7FF7FB7A2B80 반복 호출, 76줄부터는 다른 함수 호출  

![sub_7FF7FB7A2B80](https://blog.kakaocdn.net/dna/02bPS/btsDAswOIeY/AAAAAAAAAAAAAAAAAAAAAAGWB5b71DKnZQi5ZdykPZHD3hyHS0Kk72bxl9p-gacG/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=sEZ7kR5U0zPa0WjKQgLX7VUHiz0%3D)  
line 그리는 함수인듯..  

pen 생성 -> 플래그 글자 그리는 것으로 유추  

바이너리 패치  

![바이너리 패치](https://blog.kakaocdn.net/dna/IlBll/btsDxSjQ1yv/AAAAAAAAAAAAAAAAAAAAABF2YeeudY71_K_KGrVwuLH64YQ__LkGkn_XKv4cI49X/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=GrcHV%2FiNt2B%2BVWOl17kxJb2JjEw%3D)  
assemble...로 instruction ret으로 바꿔줌  
이러면 함수 형태 깨지면서 인스트럭션 retn으로 변경  

![패치 내용 적용](https://blog.kakaocdn.net/dna/vTB3F/btsDyPAs1nT/AAAAAAAAAAAAAAAAAAAAAEslq3U6ug-gXAyjxp9aBQeP4P6-QMHv5I7pC5y_V2ri/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=7E3rtGhiRhzHVJXKHTjEgn9wY4k%3D)  
패치 내용 적용  
edit - patch program - apply patches to input file...  

이거 permission denied 뜨는데 배경화면에서 하면 됨  
program files에서 하면 권한 거부당함  